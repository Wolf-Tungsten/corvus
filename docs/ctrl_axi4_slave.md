# 控制器 AXI4 Slave 接口

用于向处理器核心提供一段非缓存的、地址直接映射的控制器内存地址空间，暴露控制/状态寄存器以及流式队列。整体由读状态、写控制、流式读队列、流式写队列 4 个子控制器和 1 个 Crossbar 组成。

## 通用约束
- 遵循 AXI4 协议，作为 AXI4 从设备；地址位宽 ABITS，数据位宽 DBITS∈{32,64}，wordBytes=DBITS/8（字节编址）。
- 突发：仅支持 INCR 类型；ARSIZE/AWSIZE 固定为 log2(wordBytes)；ARLEN/AWLEN 在 AXI4 字段能力内不额外限制。
- 并发：读写通道相互独立，每方向最多 1 个 in-flight 事务；允许 1 读 + 1 写并行，但同方向不接受新的 AR/AW 直到前一读/写事务的 R/B 拍全部握手完成。
- 非对齐访问（仅寄存器子控制器）：按小端序进行字节拼接；若跨越该子控制器的地址范围，越界字节读为 0、写无副作用。
- 响应码：所有非法/越界/未对齐访问均返回 OKAY；读返回 0 数据，写无副作用（不更新寄存器、不消费/写入队列）。

## 读状态子控制器
- N_RS 为 2 的幂且 >0；每寄存器 DBITS 位，基址 0x00，占用 wordBytes。
- 支持对齐与非对齐读，按小端字节拼接；部分越界字节读为 0。
- 从核心视角只读；写请求不更新寄存器。
- 支持 INCR 突发；每个 beat 独立进行地址范围检查，越界 beat 返回 0。
- 对外暴露 Vec(N_RS, UInt(DBITS.W)) 输入。

## 写状态子控制器
- N_WS 为 2 的幂且 >0；每寄存器 DBITS 位，基址 0x00，占用 wordBytes。
- 支持对齐与非对齐读写；写按 WSTRB 和小端拼接；越界字节不写入。
- 越界读返回 0；越界写忽略。
- 支持 INCR 突发；每个 beat 独立进行地址范围检查。
- 对外暴露 Vec(N_WS, UInt(DBITS.W)) 输出。
- 参考实现模块：`WriteStatusCtrl`

## 流式读队列子控制器
- N_RQ 为 2 的幂且 >0；接口 Vec(N_RQ, Flipped(Decoupled(UInt(DBITS.W))))，基址 0x00，每队列占用 wordBytes。
- 访问必须对齐到 wordBytes；未对齐或越界的 beat 返回 0，不弹出任何队列元素。
- 支持 INCR 突发；每个 beat 根据地址选择队列；目标队列空时 RVALID 维持低直到有数据，期间不消耗队列。
- 写操作视为非法（响应码见“响应码”约定）。

## 流式写队列子控制器
- N_WQ 为 2 的幂且 >0；接口 Vec(N_WQ, Decoupled(UInt(DBITS.W)))，基址 0x00，每队列占用 wordBytes。
- 访问必须对齐到 wordBytes；未对齐或越界的 beat 被忽略，不入队。
- 支持 INCR 突发；每个 beat 根据地址选择队列。
- 队列满时对 W 通道施加背压（如拉低 WREADY）；仅在成功入队后拉高 BVALID 应答。读操作视为非法（响应码见“响应码”约定）。

## Crossbar
- 地址空间依次拼接：读状态(N_RS*wordBytes) → 写状态(N_WS*wordBytes) → 读队列(N_RQ*wordBytes) → 写队列(N_WQ*wordBytes)。
- 读写双路径独立：AR/R 走读路径，AW/W/B 走写路径；每条路径一次只服务 1 笔突发，但读与写可并行。
- 转发基于对齐后的地址头；整笔突发转发到单一子控制器，越界判断在子控制器内按 beat 处理。
